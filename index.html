<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Production Tracking</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/vfs_fonts.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>Production Tracking</h1>

      <!-- Supervisor Name Input -->
      <div class="supervisor-input">
        <label for="supervisorName">Supervisor Name:</label>
        <input
          type="text"
          id="supervisorName"
          placeholder="Enter Supervisor Name"
        />
      </div>

      <form id="jobForm">
        <input type="text" id="item" placeholder="Item" required />
        <input type="number" id="quantity" placeholder="Quantity" required />
        <input type="date" id="jobDate" required />
        <button type="submit">Add Job</button>
      </form>

      <table>
        <thead>
          <tr>
            <th>SL</th>
            <th>Item</th>
            <th>Quantity</th>
            <th>Date (DD/MM/YYYY)</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Total Time</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="jobTableBody"></tbody>
      </table>

      <button id="generatePDF">Generate PDF Report</button>
    </div>

    <script>
      // ... [Keep all previous JavaScript code until the PDF generation part]

      document
        .getElementById("generatePDF")
        .addEventListener("click", function () {
          const tableData = [];
          const rows = document.querySelectorAll("#jobTableBody tr");
          const supervisorName =
            document.getElementById("supervisorName").value ||
            "Unnamed Supervisor";

          rows.forEach((row) => {
            const cells = row.querySelectorAll("td");
            const rowData = [];

            for (let i = 0; i < cells.length - 2; i++) {
              if (i === 4 || i === 5) {
                // Start Time and End Time
                rowData.push(cells[i].querySelector("input").value);
              } else if (i === 3) {
                // Date Column (already in DD/MM/YYYY format)
                rowData.push(cells[i].innerText);
              } else {
                rowData.push(cells[i].innerText);
              }
            }

            tableData.push(rowData);
          });

          const docDefinition = {
            pageOrientation: "landscape",
            content: [
              { text: "Daily Production Report", style: "header" },
              {
                table: {
                  headerRows: 1,
                  widths: ["auto", "*", "auto", "auto", "auto", "auto", "auto"],
                  body: [
                    [
                      { text: "SL", style: "tableHeader" },
                      { text: "Item", style: "tableHeader" },
                      { text: "Quantity", style: "tableHeader" },
                      { text: "Date (DD/MM/YYYY)", style: "tableHeader" },
                      { text: "Start Time", style: "tableHeader" },
                      { text: "End Time", style: "tableHeader" },
                      { text: "Total Time", style: "tableHeader" },
                    ],
                    ...tableData,
                  ],
                },
              },
              {
                columns: [
                  {
                    text: `Prepared By:\n${supervisorName}`,
                    style: "footerLeft",
                  },
                  {
                    text: "Approved By:\nProduction Manager",
                    style: "footerRight",
                  },
                ],
                margin: [40, 20, 40, 0],
              },
            ],
            styles: {
              header: {
                fontSize: 18,
                bold: true,
                alignment: "center",
                margin: [0, 0, 0, 20],
              },
              tableHeader: {
                bold: true,
                fillColor: "#f2f2f2", // Light grey background
                alignment: "center",
              },
              footerLeft: {
                fontSize: 12,
                alignment: "left",
                margin: [0, 20, 0, 0],
              },
              footerRight: {
                fontSize: 12,
                alignment: "right",
                margin: [0, 20, 0, 0],
              },
            },
          };

          pdfMake
            .createPdf(docDefinition)
            .download(
              `Production_Report_${new Date()
                .toLocaleDateString("en-GB")
                .replace(/\//g, "-")}.pdf`
            );
        });
    </script>
  </body>
</html>
